## การสร้างเว็บแอพพลิเคชันโดยใช้ ASP.NET MVC 4 ตอนที่ 1 : รู้จักแนวคิดของ MVC

<div class="post-content"><p>สวัสดีครับ บทความตอนที่ 1 นี้จะสอนให้ท่านเข้าใจวิธีการสร้างเว็บแอพพลิเคชันโดยใช้ภาษา C#, JavaScript, HTML, CSS ตลอดจนแนวคิดการออกแบบเว็บแอพพลิเคชันบน MVC (Model-View-Controller) framework ก่อนอื่น คอมพิวเตอร์ของท่านต้องติดตั้งโปรแกรม Visual Studio สำหรับเขียนและดีบั๊กโค้ด หากใครยังไม่มี ก็สามารถดาวน์โหลดเวอร์ชัน Community มาใช้ฟรีได้<a href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">ที่นี่</a> </p>
<p>ลำดับถัดมา คอมพิวเตอร์ของท่านต้องติดตั้งโปรแกรม <a href="http://www.microsoft.com/en-us/server-cloud/products/sql-server-editions/sql-server-express.aspx">Microsoft SQL Server Express</a> สำหรับการเก็บและสืบค้นข้อมูลในดาต้าเบส และโปรแกรมเว็บเซิร์ฟเวอร์ <a href="http://www.microsoft.com/en-us/download/details.aspx?id=34679">IIS Express</a> สำหรับโฮสต์และเอ็กซิคิวต์ตัว logic ที่เราสร้างไว้ในแอพพลิเคชัน MVC นั่นเอง เมื่อท่านมีเครื่องมือพร้อมแล้ว ให้เปิดโปรแกรม Visual Studio แล้วคลิก New Project (หรือคลิกเมนู File &gt; New &gt; Project) เพื่อสร้างโปรเจ็กต์ใหม่</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463720695637-MVC4_01_02.jpg?t=1463720734846" alt="image title"> </p>
<p>ภายในหน้าต่าง New Project ท่านจะพบเท็มเพลตต่างๆ สำหรับสร้างแอพพลิเคชันสารพัดรูปแบบ ให้เลือก Visual C# &gt; ASP.NET MVC 4 Web Application จากนั้นตั้งชื่อโปรเจ็กต์ เลือกโฟลเดอร์ที่จะเซฟโปรเจ็กต์ แล้วคลิกปุ่ม OK</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463720876814-MVC4_01_03.jpg?t=1463720903827" alt="image title"> </p>
<p>โปรแกรม Visual Studio จะให้ท่านเลือกเทมเพลตย่อยในการสร้างโปรเจ็กต์ ในที่นี้ เลือก Internet Application ซึ่งมีโฮมเพจ ตลอดจนยูสเซอร์อินเทอร์เฟซ (UI) และหน้า login สำเร็จรูป ส่วน View engine เป็นส่วนประกอบของแอพพลิเคชันที่ช่วยให้ท่านสร้าง HTML สำหรับตอบกลับไปหาเว็บบราวเซอร์ ให้เลือกเป็น Razor และกาเครื่องหมายถูกที่ Create a unit test project เพื่อให้ Visual Studio สร้างโปรเจ็กต์ยูนิตเทสต์ด้วย แล้วคลิกปุ่ม OK</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463720939195-MVC4_01_04.jpg?t=1463720947795" alt="image title"> </p>
<p>สิ่งที่พึงสังเกต คือ Visual Studio จะรวบรวมไลบรารีต่างๆ ภายนอก เช่น jQuery, jQuery UI เข้ามาในโปรเจ็กต์เป็น NuGet packages ซึ่งช่วยให้ง่ายต่อการอัพเดทไลบรารีเหล่านี้ภายหลัง เพราะท่านไม่ต้องลำบากเข้าเว็บดาวน์โหลดและก็อบปี้ไฟล์ไปมาอีก เอาล่ะครับ เมื่อสร้างโปรเจ็กต์เสร็จแล้ว ทดลองรันแอพพลิเคชันนี้ในโปรแกรม Internet Explorer ด้วยการคลิกปุ่ม play หรือกดแป้น F5</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463720985967-MVC4_01_05.jpg?t=1463720988945" alt="image title"> </p>
<p>Visual Studio จะคอมไพล์โค้ดและรันเว็บแอพพลิเคชัน นี่คือหน้าตาของเทมเพลต Internet Application ที่ท่านเลือกตอนสร้างโปรเจ็กต์ อันประกอบด้วยโฮมเพจ สีสัน สไตล์ และเมนูดีฟอลต์ ดังรูป</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463721015099-MVC4_01_06.jpg?t=1463721017859" alt="image title"> </p>
<p>คลิกเมนู Contact สังเกตว่า URL ที่ปรากฏคือ /Home/Contact หน้าตาสวยงามเกลี้ยงเกลา ไม่มีนามสกุลใดๆ ต่อท้าย</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463721039639-MVC4_01_07.jpg?t=1463721043197" alt="image title"> </p>
<p>คราวนี้ คลิกขวาบนหน้าเว็บ เลือก View Source เพื่อดูซอร์สโค้ด HTML</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463721075463-MVC4_01_08.jpg?t=1463721078265" alt="image title"> </p>
<p>โดยดีฟอลต์ หน้าเว็บมีการใช้แท็ก viewport ซึ่งช่วยในเรื่องการปรับหน้าจอดูเว็บบนอุปกรณ์โมบายล์ (ต้องทำงานร่วมกับชุดคำสั่งใน style sheet) หากปราศจากแท็ก viewport อุปกรณ์โมบายล์จะอนุมานว่าหน้าเว็บของท่านมีความกว้างเกิน 900 pixel แล้ว zoom out เนื้อหาทั้งหน้าเว็บให้พอดีแสดงบนจอภาพแคบๆ ทำให้ตัวอักษรเล็กตีบลงตามไปด้วย</p>
<p>นอกจากนี้ โค้ด HTML ยังมีลิงก์ชี้ไปยัง Modernizer JavaScript library ที่ช่วยให้ element ของ HTML 5 อย่าง </p>
<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;header&gt;</span><span class="pln">, </span><span class="tag">&lt;section&gt;</span><span class="pln">, </span><span class="tag">&lt;nav&gt;</span><span class="pln"> </span></code></li></ol></pre>
<p>แสดงผลบนเว็บบราวเซอร์รุ่นเก่าๆ อย่าง Internet Explorer 6 ได้อย่างถูกต้อง</p>
<p>ต่อมา ให้ปิดเว็บบราวเซอร์แล้วกลับมาที่โปรแกรม Visual Studio โฟกัสหน้าต่าง Solution Explorer ซึ่งเป็นบริเวณสำหรับเข้าถึงไฟล์ทั้งหมดในโปรเจ็กต์นี้ ไม่ว่าจะเป็นไฟล์ C#, JavaScript, CSS, ไอคอน หรือรูปภาพ ส่วนโฟลเดอร์ที่สำคัญๆ มีอยู่ 3 อัน ได้แก่ Models, Views และ Controllers</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463721283887-MVC4_01_09.jpg?t=1463721287687" alt="image title"> </p>
<p><strong>แนวคิด Model-View-Controller</strong> </p>
<p>MVC เป็นชื่อของ design pattern ที่แยกองค์ประกอบ Model, View และ Controller ออกจากกัน MVC เป็นแนวคิดที่มีการใช้งานมานานหลายทศวรรษ ประโยชน์ของ MVC คือการแยกความรับผิดชอบขององค์ประกอบต่างๆ ในระดับ user interface ดังแผนผังข้างล่าง</p>
<p><img class="img-responsive post-image" src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/20/1463721357814-MVC4_01_10.jpg?t=1463721360934" alt="image title"> </p>
<p>เริ่มต้นที่ Controller เว็บบราวเซอร์จะส่ง HTTP request เข้ามาตรงนี้ เช่น เราเปิดเว็บบราวเซอร์ไปที่ /Home/About การร้องขอก็จะวิ่งมาที่ Controller ของเว็บแอพพลิเคชัน ซึ่งมีหน้าที่สร้างโมเดลจากคลาสที่เก็บอยู่ใน Model เพื่อเตรียมนำเสนอแก่ผู้เข้าชมเว็บไซต์</p>
<p>ขั้นตอนถัดไป Controller จะเลือก View เพื่อแสดงโมเดลที่สร้างขึ้นมา ท่านอาจจะมองวิวเหมือน template ที่หยิบข้อมูลจากโมเดลมาใส่ในบริเวณที่กำหนดบนหน้าเว็บก็ได้ เช่น ใส่ในย่อหน้านี้ หรือใส่ตรงตารางนี้ สรุปคือเราจะแบ่งพฤติกรรมต่างๆ ในยูสเซอร์อินเทอร์เฟซเข้าอยู่ในหมวดใดหมวดหนึ่ง ระหว่าง Model, View หรือ Controller</p>
<p>View จะไม่รู้วิธีเรียกข้อมูลจาก data access layer ตรงๆ เนื่องจากข้อมูลทั้งหมดที่ต้องการได้มาจาก Model หมดแล้ว ส่วน Controller ก็ไม่จำเป็นต้องรู้ว่าจะวาง error message ไว้ตรงไหนบนหน้าเว็บ หรือจะทำตัวอักษรสีอะไร เพราะนั่นเป็นหน้าที่ของ View ที่ต้องทำ</p>
<p>การแยกหน้าที่บน MVC design pattern ช่วยให้การแก้ไขแอพพลิเคชันในภายหลังทำได้สะดวกขึ้น เนื่องจากโค้ดที่เขียนไว้ในแต่ละส่วนจะโฟกัสหน้าที่ชัดเจน อ่านเข้าใจง่าย ท่านอาจจะเพิ่มลอจิกใน Controller ให้พิจารณาเลือกใช้โมเดลที่ดีที่สุด โดยไม่กระทบกับ View ที่สนใจแค่เรื่องการแสดงผลข้อมูล</p>
<p>MVC design pattern ไม่บังคับว่าแอพพลิเคชันจะดึงข้อมูลจากแหล่งใด ท่านอาจจะดึงข้อมูลจากไฟล์ เว็บเซอร์วิส ดาต้าเบส หรือ data source รูปแบบอื่น รวมทั้งไม่บังคับหน้าตาของ business object หรือ domain layer แม้กระทั่งว่าแอพพลิเคชันจะแบ่งการทำงานเป็น layer หรือเปล่าก็ไม่สน พูดง่ายๆ MVC เป็นเพียง design pattern สำหรับสร้างยูสเซอร์อินเทอร์เฟซ ไม่มีอะไรซับซ้อนกว่านั้น</p>
<p>เพราะฉะนั้น MVC framework จึงได้รับการพัฒนาเพื่อช่วยท่านออกแบบแอพพลิเคชันตามหลักการของ MVC design pattern โดยมอบเครื่องมือและคลาสต่างๆ ในการสร้าง Model, View และ Controller ตลอดจนสามารถทำงานร่วมกับเทคโนโลยีฝั่งเว็บ อย่าง JavaScript, HTML และ CSS</p>
<p>MVC framework ทำงานอยู่ในระดับเหนือคอร์ ASP.NET runtime ซึ่งมีอายุนานเกินหนึ่งทศวรรษ เป็นเทคโนโลยีที่พิสูจน์แล้วในด้านความเสถียรและสมรรถนะ หากท่านคุ้นเคยกับ ASP.NET และรู้จักวิธีใช้งาน HTTP module, handler, caching ต่างๆ อย่างดีแล้ว การพัฒนาแอพพลิเคชันตามแนวคิดของ MVC จะกลายเป็นเรื่องไม่ลำบากเลย ที่สำคัญ MVC framework ยังสนับสนุน plug-in เสริมของผู้ผลิตค่ายอื่น และรองรับการทำ unit test อีกด้วย</p></div>

## การสร้างเว็บแอพพลิเคชันโดยใช้ ASP.NET MVC 4 ตอนที่ 2 : วิธีส่งผ่านค่าไปยัง

<div class="post-content"><p><em>บทความนี้เป็นภาคต่อจากตอนที่ 1 ว่าด้วยการสร้างเว็บแอพพลิเคชัน ASP.NET MVC 4 จากเทมเพลตสำเร็จรูปในโปรแกรม Visual Studio และแนวคิดของ MVC design pattern</em> </p>
<p>พิจารณาสิ่งที่เกิดขึ้นเมื่อคลิกลิงก์ About ในเว็บแอพพลิเคชัน เว็บบราวเซอร์จะส่ง HTTP request ไปยัง IIS Express ซึ่งเป็นโปรแกรมเว็บเซิร์ฟเวอร์ทดสอบที่รันในโหมดแบ็กกราวน์บนเครี่องของท่านเอง (localhost)</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912798793-MVC4_02_01.jpg?t=1463912809477" alt="image title" class="img-responsive post-image"> </p>
<p>ท่านสามารถเรียกดูโปรแกรม IIS Express ที่กำลังทำงานอยู่ได้จาก system tray บนทาส์กบาร์ของวินโดวส์ ให้คลิกขวาที่ไอคอนของ IIS Express &gt; Show All Applications ก็จะพบว่า IIS Express กำลังรันแอพพลิเคชัน Mvc4App บนพอร์ต 13355 ซึ่งเป็นพอร์ตชั่วคราวที่ใช้ขณะพัฒนาโปรแกรม จากนั้น IIS Express จะรับรีเควสต์แล้วส่งต่อไปยังเว็บแอพพลิเคชัน MVC ของเรา</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912877783-MVC4_02_02.jpg?t=1463912881728" alt="image title" class="img-responsive post-image"> <img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912893325-MVC4_02_03.jpg?t=1463912895426" alt="image title" class="img-responsive post-image"> <img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912917729-MVC4_02_04.jpg?t=1463912922749" alt="image title" class="img-responsive post-image"> </p>
<p>เว็บแอพพลิเคชัน MVC ทุกตัวๆ จะมี routing engine ที่คอยรับรีเควสต์และส่งต่อไปยังคลาสใดคลาสหนึ่งข้างในโฟลเดอร์ Controllers โดยปกติแล้ว รีเควสต์ที่ส่งมายัง /Home/{อะไรบางอย่าง} จะไปสุดทางที่ HomeController ดังนั้น การรีเควสต์ /Home/About จึงไปสุดทางที่เมธอด About ภายใน HomeController โปรดสังเกตว่าการตั้งชื่อเมธอดให้ถูกต้องตรงกัน (naming convention) คือปัจจัยที่ช่วยให้รีเควสต์ค้นหาเมธอดที่ใช่ได้สำเร็จ</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912959214-MVC4_02_05.jpg?t=1463912962282" alt="image title" class="img-responsive post-image"> <img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463912990592-MVC4_02_06.jpg?t=1463912993511" alt="image title" class="img-responsive post-image"> </p>
<p>เมธอดประเภท public ใน Controller เหล่านี้เรียกว่า action แต่กรณีแอ็กชัน About ในตัวอย่างนี้ไม่ได้มีกิจหน้าที่อะไรมาก ไม่มีการสั่งสร้างโมเดลด้วย มีเพียงรีเทิร์น View ซึ่งเป็น ActionResult ประเภทหนึ่งที่ action สามารถรีเทิร์นออกมาได้</p>
<p>ActionResult เป็นตัวที่กำหนดว่า MVC framework จะต้องทำอะไรต่อไป บางที ท่านอาจต้องการ redirect user ไปยังที่ใดสักแห่ง หรือต้องการรีเทิร์นค่าบางอย่างในรูปแบบที่ JavaScript สามารถนำไปใช้ต่อได้ การรีเทิร์น View จึงเป็นการบอก MVC framework ว่าสิ่งที่ท่านปรารถนาให้ทำต่อไปคือการเร็นเดอร์วิวบนหน้าจอ แต่จะเลือกวิวอะไรดีล่ะ?</p>
<p>MVC framework จะควานหาวิวในโฟลเดอร์ Views ของเว็บแอพพลิเคชัน ทีนี้ naming convention จะกลับมามีบทบาทอีกครั้ง โปรดสังเกตโฟลเดอร์ Home ที่ชื่อของมันตรงกับชื่อคอนโทรลเลอร์ HomeController ที่เราสนใจอยู่</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913029459-MVC4_02_07.jpg?t=1463913031788" alt="image title" class="img-responsive post-image"> </p>
<p>หากขยายโฟลเดอร์นี้ออกมาก็จะพบวิวชื่อว่า About ที่ถูกต้องตรงกับ action ใน HomeController ที่เรากำลังสนใจอยู่เช่นกัน เมื่อเปิดวิวตัวนี้ ท่านจะเห็นรายละเอียดต่างๆ ที่วิวเร็นเดอร์ออกทางหน้าจอ ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913054884-MVC4_02_08.jpg?t=1463913057173" alt="image title" class="img-responsive post-image"> </p>
<p>วิว About นี้มีนามสกุล .cshtml ซึ่งเป็นดีฟอลต์เอ็กซเท็นชั่นของ Razor view และสังเกตว่าวิวฝั่งซ้ายมือไม่ได้รวมทุกสิ่งทุกอย่างที่ปรากฏในเว็บบราวเซอร์ เช่น ข้อความ your logo here, ลิงก์ Register, ลิงก์ Log in, เมนู Home/About/Contact, ข้อความ copyright ซึ่งเป็น layout view ที่เราต้องการให้แสดงทุกหน้าในเว็บแอพพลิเคชัน ทั้งนี้ วิว About มีเพียงเนื้อหาที่เจาะจงเฉพาะแอ็กชั่น About เท่านั้น</p>
<p>กลับมาที่ HomeController ตรงแอ็กชั่น About เราจะดูวิธีนำข้อมูลมาใส่ใน ViewBag ซึ่งเป็น dynamically typed object ในภาษา C# หมายความว่า ท่านสามารถเพิ่ม property อื่นๆ ลงใน ViewBag ได้ตามใจ เพื่อให้ดึงออกมาแสดงผลบนหน้าจอ</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913090327-MVC4_02_09.jpg?t=1463913094290" alt="image title" class="img-responsive post-image"> </p>
<p>ลองเล่นกับ ViewBag โดยเพิ่มพร็อพเพอร์ตี้ ViewBag.Location ลงไปที่แอ็กชั่น About ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913111802-MVC4_02_10.jpg?t=1463913113790" alt="image title" class="img-responsive post-image"> </p>
<p>แล้วไปแก้ไฟล์ About.cshtml เสียใหม่ ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913140056-MVC4_02_11.jpg?t=1463913142866" alt="image title" class="img-responsive post-image"> </p>
<p>เครื่องหมาย @ เป็นวิธีบอก Razor view engine ว่านี่คือ C# expression ที่ต้องการให้พิจารณา แล้วดึงผลลัพธ์มาเขียนไว้ที่บริเวณนี้ จากนั้นให้รันโปรเจ็กต์ใหม่อีกครั้ง ได้ผลดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913172404-MVC4_02_12.jpg?t=1463913175517" alt="image title" class="img-responsive post-image"> </p>
<p>นี่คือวิธีหนึ่งที่ Controller สามารถใช้ส่งผ่านข้อมูลไปยังวิว ส่วนอีกวิธีคือการใช้ strongly typed model โปรเจ็กต์ MVC ทุกอันๆ จะมีโฟลเดอร์ Models ซึ่งท่านสามารถใช้ประโยชน์ในการสร้างโมเดลใหม่ขึ้นมา แม้ในทางปฏิบัติ โมเดลสามารถอยู่ที่ใดก็ได้ หรืออยู่คนละโปรเจ็กต์เลยก็ยังได้ (แต่ท่านต้อง reference โปรเจ็กต์นั้นด้วย) ให้คลิกขวาที่โฟลเดอร์ Models &gt; Add &gt; Class แล้วตั้งชื่อคลาสใหม่ว่า AboutModel</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913195876-MVC4_02_13.jpg?t=1463913200808" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913225184-MVC4_02_14.jpg?t=1463913227669" alt="image title" class="img-responsive post-image"></p>
<p>ได้คลาสใหม่แล้ว ทดลองเพิ่มพร็อพเพอร์ตี้ 2 อันเข้าไป ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913245099-MVC4_02_15.jpg?t=1463913247655" alt="image title" class="img-responsive post-image"> </p>
<p>กลับมาที่ HomeController แก้ไขแอ็กชั่น About โดยยกเลิก ViewBag แล้วเปลี่ยนมาประกาศ instance ใหม่ของ AboutModel โดยเริ่มพิมพ์ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913265774-MVC4_02_16.jpg?t=1463913268283" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913277190-MVC4_02_17.jpg?t=1463913279251" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913287755-MVC4_02_18.jpg?t=1463913298302" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913317256-MVC4_02_19.jpg?t=1463913319655" alt="image title" class="img-responsive post-image"> </p>
<p>เอาล่ะครับ เราสร้างโมเดล model เสร็จแล้ว ก็สามารถบอก MVC framework ว่าเมื่อต้องการเร็นเดอร์วิวนี้ให้ใช้โมเดล model ที่สร้างขึ้น และเราก็ส่งผ่าน model นี้ไปยัง View </p>
<p>ขั้นตอนถัดไปคือการแก้วิว About.cshtml ให้เปลี่ยนมาใช้โมเดลใหม่นี้ในการแสดงผล ก่อนอื่นขอให้ Rebuild โปรเจ็กต์สักรอบหนึ่งเพื่อความชัวร์ และลงมือพิมพ์ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913349835-MVC4_02_20.jpg?t=1463913352565" alt="image title" class="img-responsive post-image"> </p>
<p>เสร็จแล้วให้รันโปรแกรม จะได้ผลลัพธ์ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913371128-MVC4_02_21.jpg?t=1463913373336" alt="image title" class="img-responsive post-image"> </p>
<p>นี่คือการสร้างวิวโดยใช้ strongly typed model ซึ่งเป็นวิธีที่นักพัฒนาแอพพลิเคชัน MVC ใช้กันเป็นปกติ สำหรับบทความครั้งหน้าจะแนะนำ JavaScript และ CSS ใน ASP.NET framework โปรดติดตามครับ!</p></div>

## การสร้างเว็บแอพพลิเคชั่นโดยใช้ ASP.NET MVC 4 ตอนที่ 3 : JavaScript, CSS และ HTML

<div class="post-content"><p><em>บทความนี้เป็นภาคต่อจากตอนที่ 1 ว่าด้วย flow การทำงานของเว็บแอพพลิเคชัน ASP.NET MVC ตั้งแต่การได้รับ HTTP request เข้ามาจนกระทั่งการเร็นเดอร์วิวออกมาในเว็บบราวเซอร์</em></p>
<p>ตามที่เคยกล่าวในบทความตอนที่ 1 จุดมุ่งหมายที่สำคัญอีกประการของ MVC framework คือการทำงานร่วมกับเทคโนโลยีฝั่งเว็บอย่าง HTML 5, JavaScript และ CSS 3 ได้ เรายังทราบจากตอนที่ 2 อีกว่า Razor view ในโฟลเดอร์ Views มีหน้าที่เขียน HTML ออกทางเว็บบราวเซอร์ แต่ก็ยังเหลืออีกสองโฟลเดอร์ที่ยังไม่ได้ศึกษากัน นั่นคือ โฟลเดอร์ Scripts และ Content</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913694593-MVC4_03_01.jpg?t=1463913700459" alt="image title" class="img-responsive post-image"> </p>
<p>โฟลเดอร์ Scripts บรรจุไฟล์ JavaScript ซึ่งรวมไปถึงไลบรารี่และปลั๊กอิน jQuery ต่างๆ เช่น jQuery validation และ jQuery UI ส่วนโฟลเดอร์ Content จะเก็บ CSS style sheet ของเว็บไซต์นี้</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913717257-MVC4_03_02.jpg?t=1463913719309" alt="image title" class="img-responsive post-image"> </p>
<p>ไฟล์ Site.css มีหน้าที่กำหนดสีและฟอนต์ที่ปรากฏบนหน้าแอพพลิเคชัน ลองรันแอพพลิเคชันเพื่อดูหน้าตาสักรอบหนึ่งก่อน</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913742971-MVC4_03_03.jpg?t=1463913747057" alt="image title" class="img-responsive post-image"> </p>
<p>เราจะลองแก้ไข body style โดยกำหนด background-color: # 0366BB เสร็จแล้วเซฟไฟล์ Site.css และรีโหลดหน้าเว็บบราวเซอร์ ท่านจะเห็นสีพื้นหลังที่เปลี่ยนไป ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913765855-MVC4_03_04.jpg?t=1463913769435" alt="image title" class="img-responsive post-image"> </p>
<p>ต่อไปเราจะใส่รูป Logo แทนข้อความ “your logo here” ใน Layout view เริ่มจากใช้โปรแกรม Explorer ก็อบปี้ไฟล์โลโก้มาเก็บไว้ที่โฟลเดอร์ Images ของโปรเจ็กต์นี้ จากนั้นกลับมาที่โปรแกรม Visual Studio คลิกขวาที่โฟลเดอร์ Images &gt; Add &gt; New Item</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913788700-MVC4_03_05.jpg?t=1463913791174" alt="image title" class="img-responsive post-image"> </p>
<p>เลือกไฟล์โลโก้ และคลิก Add</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913807311-MVC4_03_06.jpg?t=1463913810833" alt="image title" class="img-responsive post-image"> </p>
<p>ไฟล์โลโก้ที่เรา Add เข้ามาในโปรเจ็กต์ก็จะปรากฏในลิสต์ของ Solution Explorer</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913825271-MVC4_03_07.jpg?t=1463913827787" alt="image title" class="img-responsive post-image"> </p>
<p>ต่อมาให้เปิดโฟลเดอร์ Views &gt; Shared และเรียกไฟล์ _Layout.cshtml ขึ้นมาเพื่อเปลี่ยนโค้ดใส่ข้อความ “your logo here” เป็นการใส่โลโก้ของเรา ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913860546-MVC4_03_08.jpg?t=1463913862928" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913871205-MVC4_03_09.jpg?t=1463913872944" alt="image title" class="img-responsive post-image"> </p>
<p>สุดท้ายเซฟไฟล์ _Layout.cshtml แล้วรันแอพพลิเคชันอีกครั้ง ได้ผลลัพธ์ดังรูป:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/22/1463913890408-MVC4_03_10.jpg?t=1463913892635" alt="image title" class="img-responsive post-image"> </p>
<p>แม้หน้าตาของเว็บจะดูลูกทุ่งไปนิด แต่ผมก็จะใช้หน้าตานี้เป็นจุดเริ่มเรื่องราวที่จะบรรยายในครั้งถัดไปๆ โปรดติดตามครับ :)</p></div>

## การสร้างเว็บแอพพลิเคชั่นโดยใช้ ASP.NET MVC 4 ตอนที่ 4 : Route และ Controller

<div class="post-content"><p>บทความนี้จะสอนให้ท่านเข้าใจวิธีทำงานของคอนโทรลเลอร์ใน MVC Framework รวมถึงกลไกการตัดสินใจเลือกเส้นทาง (routing rule) หลังจากที่คอนโทรลเลอร์ได้รับ HTTP request เข้ามา ผมจะใช้โปรเจ็กต์เว็บแอพพลิเคชัน ASP.NET MVC ที่สร้างขึ้นในตอนที่ 1 เพื่อประกอบการอธิบายนะครับ</p>
<p>ย้อนกลับไปดูไดอะแกรม Model-View-Controller คำถามคือ ASP.NET รู้ได้อย่างไรว่าจะต้องนำรีเควสต์อย่าง /home/about ไปยังคอนโทรลเลอร์ชื่อ HomeController? คำตอบอยู่ในตัว routing engine หมดแล้ว</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438118992-MVC4_04_01.jpg?t=1464438128487" alt="image title" class="img-responsive post-image"> </p>
<p>routing engine เป็นส่วนประกอบแกนหลักของ ASP.NET ไม่ได้ผูกกับ MVC Framework โดยตรง ท่านอาจใช้ routing engine หาเส้นทางเดินของรีเควสต์ให้กับ web form หรือ WCF service ก็ได้ แต่ในกรณี MVC เราจะใช้ routing engine นำรีเควสต์ไปยังคอนโทรลเลอร์ที่ถูกต้องตามที่ระบุไว้ในแผนที่นำทาง (route map)</p>
<p>ตอนนี้ให้รันโปรแกรม Visual Studio เปิดโปรเจ็กต์ที่ทำค้างในบทความตอนที่ 3 และเปิดไฟล์ Global.asax.cs เวลาแอพพลิเคชันเริ่มต้นทำงาน โค้ดภายในเมธอด Application_Start() จะถูกเอ็กซิคิวต์หนึ่งครั้งก่อนที่คอนโทรลเลอร์ตัวใดตัวหนึ่งจะเอ็กซิคิวต์เสมอ และเป็นบริเวณที่เราจะตั้งค่าคอนฟิกูเรชันที่จำเป็น เช่น routing configuration (ดู RouteConfig) ที่มีการรับค่า global routing table หรือตารางเก็บเส้นทางฯ ทั้งหมดของแอพพลิเคชันเข้าไป</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438161566-MVC4_04_02.jpg?t=1464438171469" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438176877-MVC4_04_03.jpg?t=1464438186561" alt="image title" class="img-responsive post-image"> </p>
<p>แรกสุดตาราง global routing table จะว่างเปล่า แต่พอเรียกใช้เมธอด RegisterRoutes จะมีการเพิ่มเอ็นทรีต่างๆ เข้าไปในตารางนี้ หากเลื่อนเมาส์ไปคลิกขวาที่ RegisterRoutes &gt; Go To Definition (หรือกดแป้น F12) โปรแกรม Visual Studio ก็จะเปิดไฟล์ App_Start\RouteConfig.cs ขึ้นมา</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438195880-MVC4_04_04.jpg?t=1464438205604" alt="image title" class="img-responsive post-image"> </p>
<p>โปรแกรม Visual Studio สร้างไฟล์ RouteConfig.cs ให้เราอัตโนมัติตอนสร้างโปรเจ็กต์ สิ่งที่ต่างจาก ASP.NET MVC เวอร์ชันก่อนๆ คือโค้ดสตาร์ทอัพที่เคยกระจุกรวมอยู่ใน Global.asax.cs ตอนนี้จะได้รับการซอยออกเป็นคลาสย่อยๆ เก็บไว้ในโฟลเดอร์ App<em>Start คลาสทั้งหมดนี้จะถูกเรียกใช้โดยเมธอด Application</em>Start() ใน Global.asax.cs</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438217812-MVC4_04_05.jpg?t=1464438227345" alt="image title" class="img-responsive post-image"> </p>
<p>ตามที่ทราบดีว่า หน้าที่ของเราติงเอ็นจิ้นคือพิจารณา URL ที่ผู้ใช้ป้อนเข้ามาและตัดสินใจว่าจะส่งรีเควสต์ไปที่ไหนต่อเพื่อประมวลผล ซึ่งในแอพพลิเคชัน MVC เราต้องการ URL เพื่อระบุคอนโทรลเลอร์ที่จะส่งต่อ และแอ็กชั่นที่จะกระตุ้นให้ทำงานต่อ </p>
<p>ดังนั้นจึงมีการระบุ URL pattern ในไฟล์ RouteConfig.cs เพื่อให้เราติงเอ็นจิ้นรู้จัก URL pattern ที่สามารถใช้พิจารณาและค้นหาพารามิเตอร์ที่อยู่ใน URL นั้นๆ กล่าวคือ คำที่อยู่ข้างในเครื่องหมายปีกกาจะเป็นชื่อพารามิเตอร์ หากเราติงเอ็นจิ้นไม่สามารถค้นหาข้อมูลบางชิ้นจาก URL ได้ เช่น ชื่อคอนโทรลเลอร์ หรือชื่อแอ็กชั่น เราติงเอ็นจิ้นก็จะหันไปหยิบข้อมูลเหล่านี้จาก default parameter แทน</p>
<p>สมมติผู้ใช้ป้อน /Home/Index ในเว็บบราวเซอร์ กรณีนี้ เราติงเอ็นจิ้นจะมอง Home เป็นชื่อคอนโทรลเลอร์ มอง Index เป็นชื่อแอ็กชั่น แต่ไม่มี id ปรากฎอยู่ใน URL ไม่เป็นไรครับ เพราะเราได้มีการระบุค่าดีฟอลต์ไว้แล้วใน route map หรือหากผู้ใช้ป้อนแค่ /Home ถึงจะไม่มีชื่อแอ็กชั่นใน URL แต่เราติงเอ็นจิ้นก็จะเลือกแอ็กชั่นจากค่าดีฟอลต์นั่นคือ Index</p>
<p>เมื่อเราติงเอ็นจิ้นแยก URL ออกเป็นชิ้นๆ มันจะสร้างโครงสร้างชั้นข้อมูล (data structure) ขึ้นเพื่อส่งไปยัง MVC framework จากนั้นเฟรมเวิร์กจะพิจารณาโครงสร้างชั้นข้อมูลฯ เพื่อดูว่าอะไรคือคอนโทรลเลอร์ อะไรคือแอ็กชั่น แล้วใช้ข้อมูลตรงนี้เพื่อนำรีเควสต์ไปสู่คอนโทรลเลอร์ เช่น HomeController เป็นต้น ลองสลับไปเปิด/แก้ไขไฟล์ Controllers/HomeController.cs เพื่อดูว่าเราจะ track ข้อมูลเหล่านี้ได้อย่างไรบ้าง ผมต้องการพิสูจน์ว่าเว็บบราวเซอร์เปิดหน้า Index ขึ้นมาได้นั้นเป็นผลจากคอนโทรลเลอร์ตัวไหน แอ็กชั่นอะไร ก็ต้องไปขอพึ่งข้อมูลจากโครงสร้างชั้นข้อมูล RouteData ที่สร้างโดยเราติงเอ็นจิ้น ซึ่งทำได้โดยการแก้โค้ดดังรูป แล้วรันแอพพลิเคชัน:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438245536-MVC4_04_06.jpg?t=1464438255114" alt="image title" class="img-responsive post-image"> </p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438255240-MVC4_04_07.jpg?t=1464438264820" alt="image title" class="img-responsive post-image"> </p>
<p>คราวนี้ ลองพิมพ์ URL เป็น http://localhost:{เลขพอร์ตที่ท่านใช้}/Home หรือ http://localhost: {เลขพอร์ตที่ท่านใช้}/Home/Index ก็ยังได้หน้าตาเหมือนเดิม แต่พอพิมพ์เป็น http://localhost: {เลขพอร์ตที่ท่านใช้}/Home/Index/256 จะได้หน้าจอเช่นนี้:</p>
<p><img src="https://s3-ap-southeast-1.amazonaws.com/codesanook-static/uploaded/2016/5/28/1464438272672-MVC4_04_08.jpg?t=1464438281966" alt="image title" class="img-responsive post-image"> </p>
<p>ถึงจุดนี้ ผมเพียงต้องการแสดงให้เห็นว่า เราติงเอ็นจิ้นมีหน้าที่แยก URL ออกเป็นส่วนๆ แล้วสร้างโครงสร้างชั้นข้อมูลที่ไม่เพียงให้ MVC framework มองเห็นเพื่อตัดสินใจเลือกเส้นทางเท่านั้น แต่เราเองก็สามารถมองเห็นได้ โดยข้อมูลเส้นทาง (route data) สามารถมีอยู่ในคอนโทรลเลอร์ก็ได้ อยู่ในวิวก็ได้ แต่ปกติ โค้ดที่เราเขียนกันจะไม่ปฏิบัติต่อข้อมูลเส้นทางแบบในตัวอย่างนี้ แต่เป็นหน้าที่ของ MVC framework ที่จะใช้ข้อมูลเพื่อค้นหาคอนโทรลเลอร์ที่เหมาะสม บทความตอนต่อไปจะสอนวิธีสร้างคอนโทรลเลอร์ขึ้นใช้เอง รวมถึงการสร้างแอ็กชั่นและเรียกใช้พารามิเตอร์ต่างๆ โปรดติดตามครับ</p></div>
